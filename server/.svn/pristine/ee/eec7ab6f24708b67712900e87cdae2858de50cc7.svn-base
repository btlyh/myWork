package com.cambrian.dfhm.skill;

import java.util.ArrayList;
import java.util.Random;

import com.cambrian.common.net.ByteBuffer;
import com.cambrian.common.net.DataAccessException;
import com.cambrian.common.object.Sample;
import com.cambrian.common.object.SampleFactory;
import com.cambrian.dfhm.battle.BattleCard;

/**
 * 类说明：卡牌技能基类
 * @author：Sebastian
 *
 */
public class Skill extends Sample{

	/* static fields */
	/** 样本工厂 */
	public static SampleFactory factory = new SampleFactory();

	/* static methods */
	/** 获得一个的关卡 */
	public static Skill getSkill(int sid)
	{
		Skill skill=(Skill)factory.getSample(sid);
		if(skill == null)
			throw new DataAccessException(
				DataAccessException.CLIENT_SDATA_ERROR,sid+"");// 不准改为编号
		return skill;
	}	

	/* fields */
	private String name;
	/** 介绍 */
	private String description;
	/** 攻击范围 */
	private int attRange;
	/** 等级 */
	private int level;
	/** 攻击系数 */
	private int att;
	/** 攻击对象，1=自己，2=敌人 */
	private int aim;
	/** 死亡为止记录 */
	private ArrayList<Integer> dieIndex = new ArrayList<Integer>();
	
	/* constructors */

	/* properties */
	public String getName() {
		return name;
	}
	public void setName(String name) {
		this.name = name;
	}
	public String getDescription() {
		return description;
	}
	public void setDescription(String description) {
		this.description = description;
	}
	public int getAttRange() {
		return attRange;
	}
	public void setAttRange(int attRange) {
		this.attRange = attRange;
	}
	public int getLevel() {
		return level;
	}
	public void setLevel(int level) {
		this.level = level;
	}
	public int getAtt() {
		return att;
	}
	public void setAtt(int att) {
		this.att = att;
	}
	public int getAim() {
		return aim;
	}
	public void setAim(int aim) {
		this.aim = aim;
	}

	/* init start */
	public ArrayList<Integer> getDieIndex() {
		return dieIndex;
	}
	/* methods */
	/**
	 * 技能攻击伤害值计算
	 * @param attCard	攻击者
	 * @param aim		被攻击目标索引
	 * @param aimList	被攻击对象数组
	 * @return			被攻击对象是否死亡的位置
	 */
	public ArrayList<Integer> skillValue(BattleCard attCard, int[] aim, BattleCard[] aimList, ArrayList<Integer> record)
	{
		System.err.println("技能攻击伤害值,多态的基类哦--------------");
		return dieIndex;
	}
	
	/**
	 * 技能buff伤害值
	 * @param 	aimCard
	 * @return	被攻击对象是否死亡
	 */
	public boolean buffValue(BattleCard aimCard)
	{
		System.err.println("技能buff伤害值,多态的基类哦--------------");
		return false;
	}
	
	/** 获得技能攻击值 */
	public int getSkillHurt(BattleCard attCard)
	{
		int hurt = attCard.getAtt() * att / 1000;
		hurt += hurt * (new Random().nextInt() % 6) / 100;//%5范围浮动值
		return hurt;
	}
	
	/** 添加死亡位置 */
	public void addDieIndex(int index)
	{
		dieIndex.add(index);
	}
	
	/** 清除死亡位置 */
	public void clearDieIndex()
	{
		dieIndex.clear();
	}
	
	public void bytesWrite(ByteBuffer data)
	{
		data.writeUTF(name);
		data.writeUTF(description);
		data.writeInt(attRange);
		data.writeInt(level);
		data.writeInt(att);
		data.writeInt(aim);
	}
}
