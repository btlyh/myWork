package com.cambrian.dfhm.skill;

import java.util.ArrayList;
import com.cambrian.dfhm.battle.BattleCard;
import com.cambrian.dfhm.battle.BattleRecord;

/**
 * 类说明：追杀技能
 * @author：Sebastian
 * 
 */
public class ChaseSkill extends Skill{

	/* static fields */

	/* static methods */

	/* fields */
	/** 每次增加的攻击力百分比 */
	private int hurt;
	/** 下降血量度百分比 */
	private int hp;

	/* constructors */

	/* properties */

	/* init start */

	/* methods */
	/**
	 * 扣血量
	 * @param aimCard	
	 * @param attCard
	 * @return
	 */
	private int downHp(BattleCard aimCard, BattleCard attCard)
	{
		System.err.println("追杀技能使用 -----------------");
		int value = aimCard.getMaxHp() - aimCard.getCurHp();//减少总血量
		System.err.println("玩家减少血量 ==="+value);
		int hp_ = aimCard.getMaxHp() * hp / 100;//每次加攻，需具体减少的血量
		System.err.println("每次加攻，需具体减少的血量 ==="+hp_);
		int num = value / hp_;//加攻的次数
		System.err.println("加攻的次数 ==="+num);
		value = attCard.getAtt() + attCard.getAtt() * hurt / 100 * num;
		System.err.println("玩家攻击力 ==="+attCard.getAtt());
		System.err.println("增加后的总攻击力 ==="+value);
		value = super.getSkillHurt(value);
		System.err.println("实际照成伤害 ==="+value);
		return value;
	}
	
	@Override
	public ArrayList<Integer> skillValue(BattleCard attCard, ArrayList<Integer> aim, BattleCard[] aimList, BattleRecord record) {
		super.clearDieIndex();
		int value;
		BattleCard aimCard;
		boolean die = false;
		int index;
		for (int i = 0; i < aim.size(); i++) {
			index = aim.get(i);
			aimCard = aimList[index];
			value = downHp(aimCard, attCard);
			record.setAttMax(value);
			die = aimCard.decrHp(value);
			record.addRecord(aimCard.getIndex());
			record.addRecord(value);
			if(die)
			{
				record.addRecord(1);
				super.addDieIndex(aimCard.getIndex());
			}
			else
			{
				record.addRecord(-1);
				record.addRecord(-1);//不掉东西
			}
			System.err.println("追杀技能，照成伤害对象==="+aimCard.getName()+"血量损失 ==="+value+", 剩余血量 ==="+aimCard.getCurHp());
		}	
		return super.getDieIndex();
	}
}
