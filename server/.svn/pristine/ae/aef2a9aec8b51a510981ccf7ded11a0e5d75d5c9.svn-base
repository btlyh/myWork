package com.cambrian.dfhm.skill;

import java.util.ArrayList;

import com.cambrian.dfhm.battle.BattleCard;
import com.cambrian.dfhm.battle.BattleRecord;

/**
 * 类说明：中毒技能
 * @author：Sebastian
 * 
 */
public class PoisonSkill extends Skill{

	/* static fields */

	/* static methods */

	/* fields */
	/** 每次中毒扣血数 */
	private int hurt;
	private int round;

	/* constructors */

	/* properties */

	/* init start */

	/* methods */
	@Override
	public ArrayList<Integer> skillValue(BattleCard attCard, ArrayList<Integer> aim, BattleCard[] aimList, BattleRecord record) {
		super.clearDieIndex();
		int hp = super.getSkillHurt(attCard.getAtt());
		record.setAttMax(hp);
		BattleCard aimCard;
		boolean die = false;
		int index;
		for (int i = 0; i < aim.size(); i++) {
			index = aim.get(i);
			aimCard = aimList[index];
			die = aimCard.decrHp(hp);
			record.addRecord(aimCard.getIndex());
			record.addRecord(hp);
			if(die)
			{
				record.addRecord(1);
				super.addDieIndex(aimCard.getIndex());
			}
			else
			{
				record.addRecord(-1);
				record.addRecord(-1);//不掉东西
			}
			System.err.println("中毒技能，照成伤害对象==="+aimCard.getName()+", 血量损失 ==="+hp+", 剩余血量 ==="+aimCard.getCurHp());
		}			
		hurt = attCard.getAtt() * super.getAtt() / 1000;
		return super.getDieIndex();
	}

	@Override
	public int buffValue(BattleCard aimCard) {
		if(round > 0)
		{
			aimCard.decrHp(hurt);
			round --;
			if(round == 0)
				aimCard.setDeSkill(null);
			System.err.println("中毒状态，照成伤害对象==="+aimCard.getName()+", 血量损失 ==="+hurt+", 剩余血量 ==="+aimCard.getCurHp()+"， 剩余回合数 ==="+round);
			return hurt;
		}		
		return 0;
	}
}
